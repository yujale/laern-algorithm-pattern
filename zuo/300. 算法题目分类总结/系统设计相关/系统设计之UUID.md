# 系统设计之UUID

---

设计一个系统, 提供不同的uuid, 需要保证未来100年不同的id, 一定要求每个都不一样
1) 要求在原理上就不出现重复, 所以不能只用hash实现
2) 使用者很多, 极其频繁, 巨大的吞吐量


设想:


### ip/mac/hostname + 时间
  同一纳秒收到5万个uuid请求呢?
  ip拼, 要保证所有机器ip不一样: 当一个机器宕机, 重新上线机器有这个ip
所有机器时间要统一: 强同步问题

如何确保所有机器时间上完全的同步?
  如果同步总是有纳秒误差, 怎么处理?
  
###  有这么一种设计

利用垂直扩展的技巧

![[Pasted image 20201214150515.png]]

维持两个变量: 
1. 当前给到数字到多少号了 base/start = 17万亿
2. 下一级服务器
    1. 中国服务器, 向顶部服务器要数据, 
    2. 最小值, range, 皇帝机 base = 17万亿+500亿
所有的压力都被range化解掉

全世界 有一台皇帝机器
 不要求这台机器有多少

下面份中国, 美国, 英国
再往下 分 省, 州
再往下街道, 社区
返回response:
start, range

不用管同步问题
新上机器, 临时可以向父机要新的id

皇帝机挂了, 只要同步机器记住他的start就行, 往外极低的调用频率

这是垂直扩展

太频繁, 就增大range
机器挂了, 新上机器现场要 上级申请新的 base + range

怎么数字无限制?
用string实现大整数

  